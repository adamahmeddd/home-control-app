<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino Smart Home</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background-color: #f0f2f5; padding: 20px; }
        h1 { color: #333; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        button { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        .btn-connect { background-color: #2196F3; color: white; }
        .btn-on { background-color: #ffeb3b; color: black; font-weight: bold; }
        .btn-off { background-color: #9e9e9e; color: white; }
        .btn-open { background-color: #4CAF50; color: white; }
        .btn-close { background-color: #f44336; color: white; }
        .btn-voice { background-color: #673AB7; color: white; }
        #status { margin-bottom: 10px; color: #666; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>Nano Smart Home</h1>
    <p id="status">Disconnected</p>
    <button class="btn-connect" onclick="connectBluetooth()">üîå Connect Bluetooth</button>
    
    <hr>
    
    <h3>Lighting</h3>
    <button class="btn-on" onclick="sendCommand('1')">üü° Turn LEDs ON</button>
    <button class="btn-off" onclick="sendCommand('0')">‚ö´ Turn LEDs OFF</button>

    <h3>Door Control</h3>
    <button class="btn-open" onclick="sendCommand('O')">üö™ Open Door</button>
    <button class="btn-close" onclick="sendCommand('C')">üîí Close Door</button>

    <hr>

    <h3>Voice Control</h3>
    <button class="btn-voice" onclick="startVoice()">üéôÔ∏è Speak Command</button>
    <p id="transcript"></p>
</div>

<script>
    let bluetoothDevice;
    let characteristic;

    // Standard HM-10 UUIDs
    const serviceUUID = "0000ffe0-0000-1000-8000-00805f9b34fb";
    const charUUID = "0000ffe1-0000-1000-8000-00805f9b34fb";

    async function connectBluetooth() {
        try {
            document.getElementById('status').innerText = "Scanning...";
            bluetoothDevice = await navigator.bluetooth.requestDevice({
                filters: [{ services: [serviceUUID] }]
            });

            const server = await bluetoothDevice.gatt.connect();
            const service = await server.getPrimaryService(serviceUUID);
            characteristic = await service.getCharacteristic(charUUID);

            document.getElementById('status').innerText = "‚úÖ Connected to " + bluetoothDevice.name;
            
            // Handle disconnection
            bluetoothDevice.addEventListener('gattserverdisconnected', () => {
                document.getElementById('status').innerText = "‚ùå Disconnected";
            });

        } catch (error) {
            console.log(error);
            document.getElementById('status').innerText = "Connection Failed: " + error;
        }
    }

    async function sendCommand(cmd) {
        if (!characteristic) {
            alert("Please connect to Bluetooth first!");
            return;
        }
        try {
            let encoder = new TextEncoder();
            await characteristic.writeValue(encoder.encode(cmd));
        } catch (error) {
            console.log("Send failed", error);
        }
    }

    // Voice Recognition (Chrome Only)
    function startVoice() {
        if (!('webkitSpeechRecognition' in window)) {
            alert("Voice recognition not supported in this browser. Use Chrome.");
            return;
        }

        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'en-US';
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.start();
        document.getElementById('transcript').innerText = "Listening...";

        recognition.onresult = function(event) {
            const command = event.results[0][0].transcript.toLowerCase();
            document.getElementById('transcript').innerText = "Heard: " + command;
            processVoice(command);
        };

        recognition.onerror = function(event) {
            document.getElementById('transcript').innerText = "Error: " + event.error;
        };
    }

    function processVoice(command) {
        if (command.includes("light on") || command.includes("lights on")) {
            sendCommand('1');
        } else if (command.includes("light off") || command.includes("lights off")) {
            sendCommand('0');
        } else if (command.includes("open door") || command.includes("open the door")) {
            sendCommand('O');
        } else if (command.includes("close door") || command.includes("close the door")) {
            sendCommand('C');
        }
    }
</script>

</body>
</html>
